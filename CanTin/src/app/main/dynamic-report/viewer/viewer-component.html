<div class="row">
    <div class="col-lg-12">
        <div class="card card-outline-info">
            <div class="row" style="margin: 15px 20px;padding: 10px;background: #9cdee761;border-radius: 5px;">
                <div style="flex-grow: 1;">
                    <div style="font-size: 20px;font-weight: 500;">
                        <i style="margin-right: 5px" class="fa fa-file-o" aria-hidden="true"></i> {{reportName}}
                    </div>
                </div>
                <dx-button id="target" class="form_filter_config" (click)="openPopupConfig($event)"
                    [visible]="buttonStatusExportVisible">
                    <i class="fa fa-search-plus"> </i>
                </dx-button>
            </div>

            <div class="row" style="margin: 10px">
                <div class="col-md-12">
                    <form (submit)="viewreport()">
                        <dx-form id="dxForm" [(formData)]="formData" #form [items]="listItem"
                            validationGroup="formValidateGroup" [labelLocation]="form_labelLocation"
                            labelMode="floating" [colCount]="formColCount" (onContentReady)="onContentReady($event)"
                            style="margin-bottom: 20px">

                        </dx-form>
                        <div class="row justify-content-center" *ngIf="show_search"
                            style="margin-top: 20px; text-align: center;margin-bottom: 50px;">

                            <dx-button text="Xem" [icon]="iconClass" type="success" class="btn-kcl-success"
                                [useSubmitBehavior]="true" style="margin-right: 5px;"
                                validationGroup="formValidateGroup" [disabled]="disabled_btn_search"></dx-button>
                            <dx-button text="Hủy" icon="fa fa-arrow-left" (onClick)="back()"></dx-button>
                        </div>
                    </form>
                </div>

                <div class="btn-group dropdown btn-smaller-padding" dropdown container="body"
                    style="margin-left: 10px; margin-bottom: 5px;">
                    <!-- <dx-button icon="fas fa-file-import"
                    class="dx-button dx-button-success dx-button-mode-contained dx-widget dx-button-has-icon dx-button-has-text btn-kcl-success"
                    text="Xuất file template" style="justify-content: left; margin-bottom : 10px; margin-right: 10px;"
                    (onClick)="downloadTemplate()"></dx-button> -->
                </div>
                <div class="col-md-12" [style.visibility]="tableVisibility" [style.display]="tableDisplay" id="table">
                    <dx-data-grid #data [columns]='column' [dataSource]="dataSourceTest3" [showRowLines]="true"
                        [showBorders]="true" [allowColumnResizing]="true" [columnAutoWidth]="true"
                        [allowColumnReordering]="true" [summary]='sumary' [wordWrapEnabled]="true"
                        (onExporting)="onExporting($event)" (onExported)="onExported($event)"
                        (onToolbarPreparing)="onToolbarPreparing($event)" [columnHidingEnabled]="columnHidingEnabled">
                        <!-- <dxo-export [enabled]="true" [fileName]="reportName" [allowExportSelectedData]="false"></dxo-export> -->
                        <dxo-group-panel [visible]="true"></dxo-group-panel>
                        <dxo-column-fixing [enabled]="true"></dxo-column-fixing>
                        <dxo-grouping #expand [autoExpandAll]="true"></dxo-grouping>
                        <dxo-paging [pageSize]="pageSize" [pageIndex]="pageIndex"></dxo-paging>
                        <dxo-pager visible="true" infoText="Trang {0} trên {1} ({2} dòng)"
                            [allowedPageSizes]="[20, 50, 100]" [showPageSizeSelector]="true" [showInfo]="true">
                        </dxo-pager>
                        <div *dxTemplate="let data of 'totalGroupCount'">
                            <div style="font-style: italic;">
                                <span>Có <b>{{totalCount}}</b> kết quả tìm kiếm</span>
                            </div>
                        </div>
                    </dx-data-grid>
                </div>

                <div id="dx-grid" style="display: none"></div>
                <!-- Tree list show -->
                <div class="col-md-12" [style.visibility]="treeListVisibility" [style.display]="treeListDisplay"
                    id="treeList">
                    <dx-tree-list #treeList [columns]='column' [dataSource]="dataSourceTest3" [showRowLines]="true"
                        [showBorders]="true" [allowColumnResizing]="true" [columnAutoWidth]="false" [autoExpandAll]="expanded"
                        [allowColumnReordering]="true" [wordWrapEnabled]="true"  (onToolbarPreparing)="onToolbarPreparingTreeList($event)"
                        [columnHidingEnabled]="columnHidingEnabled" keyExpr="Id" parentIdExpr="parentId">
                        <dxo-search-panel [visible]="true" width="250"></dxo-search-panel>
                        <dxo-selection mode="multiple"></dxo-selection>
                        <dxo-column-fixing [enabled]="true"></dxo-column-fixing>
                        <dxo-scrolling mode="standard"></dxo-scrolling>
                        <dxo-paging [enabled]="true" [pageSize]="pageSizeTreeList" [pageIndex]="pageIndexTreeList">
                        </dxo-paging>
                        <dxo-pager visible="true" infoText="Trang {0} trên {1} ({2} dòng)"
                            [allowedPageSizes]="[20, 50, 100]" [showPageSizeSelector]="true" [showInfo]="true">
                        </dxo-pager>
                        <div *dxTemplate="let data of 'totalGroupCount'">
                            <div style="font-style: italic;">
                                <span>Có <b>{{totalCount}}</b> kết quả tìm kiếm</span>
                            </div>
                        </div>
                    </dx-tree-list>

                </div>
                <div id="dx-tree-list" style="display: none"></div>
                <!-- BarChart (type == 2)-->
                <div class="col-md-12" [style.visibility]="barChartVisibility" [style.display]="barChartDisplay"
                    id="barChart">
                    <dx-chart #barchart [dataSource]="barChartDataSource">
                        <dxo-series-template [nameField]="seriesField"></dxo-series-template>
                        <dxo-common-series-settings [argumentField]="ArgumentField" type="bar"
                            [valueField]="ValueField">
                            <dxo-label [visible]="true" [format]="{ formatter: formatService.formatNumber }"
                                backgroundColor="transparent">
                                <dxo-font [size]="11" color="green"></dxo-font>
                            </dxo-label>
                        </dxo-common-series-settings>
                        <dxo-legend verticalAlignment="bottom" horizontalAlignment="center">
                        </dxo-legend>
                        <dxo-export [enabled]="true"></dxo-export>
                    </dx-chart>
                </div>
                <!-- PieChart (type == 3)-->
                <div class="col-md-12" [style.visibility]="pieChartVisibility" [style.display]="pieChartDisplay"
                    id="pieChart">
                    <dx-pie-chart #piechart id="pie" palette="bright" [dataSource]="pieChartDataSource"
                        resolveLabelOverlapping="shift">
                        <dxi-series [argumentField]="ArgumentField" [valueField]="ValueField">
                            <dxo-label [visible]="true">
                                <dxo-connector [visible]="true" [width]="1"></dxo-connector>
                            </dxo-label>
                        </dxi-series>
                        <dxo-size [width]="500"></dxo-size>
                        <dxo-export [enabled]="true"></dxo-export>
                        <dxo-legend verticalAlignment="bottom" horizontalAlignment="center" itemTextPosition="right"
                            [rowCount]="2">
                        </dxo-legend>
                    </dx-pie-chart>
                </div>
                <!-- StakedChart (type == 8) -->
                <div class="col-md-12" [style.visibility]="stakedChartVisibility" [style.display]="stakedChartDisplay"
                    id="stakedChart" style="width: 100%;">
                    <dx-chart #stackedchart [dataSource]="stackedChartDataSource">
                        <dxo-series-template [nameField]="seriesField"></dxo-series-template>
                        <dxo-common-series-settings [argumentField]="ArgumentField" type="fullStackedBar"
                            [valueField]="ValueField">
                        </dxo-common-series-settings>
                        <dxo-legend verticalAlignment="bottom" horizontalAlignment="center" itemTextPosition="right">
                        </dxo-legend>
                        <dxo-export enabled="true"></dxo-export>
                        <dxo-tooltip enabled="true" location="edge" [customizeTooltip]="customizeTooltip1"
                            [zIndex]="5000"></dxo-tooltip>
                        <dxo-border [visible]="true"></dxo-border>
                    </dx-chart>
                </div>
                <!-- LineChart (type == 9) -->
                <div class="col-md-12" [style.visibility]="lineChartVisibility" [style.display]="lineChartDisplay"
                    id="lineChart" style="width: 100%;">
                    <dx-chart #linechart palette="Violet" [dataSource]="lineChartDataSource">
                        <dxo-series-template [nameField]="seriesField"></dxo-series-template>
                        <dxo-common-series-settings [argumentField]="ArgumentField" type="line"
                            [valueField]="ValueField">
                        </dxo-common-series-settings>
                        <dxo-margin [bottom]="20"></dxo-margin>
                        <dxo-argument-axis [valueMarginsEnabled]="false" discreteAxisDivisionMode="crossLabels">
                            <dxo-grid [visible]="true"></dxo-grid>
                        </dxo-argument-axis>
                        <dxo-legend verticalAlignment="bottom" horizontalAlignment="center" itemTextPosition="right">
                        </dxo-legend>
                        <dxo-export [enabled]="true"></dxo-export>
                        <dxo-tooltip enabled="true" location="edge" [customizeTooltip]="customizeTooltip1"
                            [zIndex]="5000"></dxo-tooltip>
                    </dx-chart>
                </div>
               
            </div>
        </div>
    </div>
</div>

<!-- popup form setting config -->
<div class="row">
    <div class="col-lg-12">
        <dx-popup #popupConfig [width]="350" height="auto" [maxHeight]="700" [showTitle]="true"
            title="Danh sách các cột xuất file" [closeOnOutsideClick]="true" [showCloseButton]="true"
            [(visible)]="popupConfigVisible">
            <dxi-toolbar-item widget="dxButton" toolbar="bottom" location="center" [options]="saveFormConfigOptions">
            </dxi-toolbar-item>

            <div *dxTemplate="let data of 'content'">
                <dx-scroll-view #scrollView width="100%" height="100%">
                    <dx-data-grid #gridFormConfig [rowAlternationEnabled]="true" [dataSource]="columnExportDatasource">

                        <dxo-editing mode="cell" [allowUpdating]="true" [allowDeleting]="false" [allowAdding]="false">
                        </dxo-editing>
                        <dxo-paging [enabled]="false"></dxo-paging>
                        <!-- <dxo-paging [pageSize]="10"></dxo-paging> -->
                        <dxi-column dataField="name" caption="Tên cột" [allowEditing]="false" dataType="string">
                        </dxi-column>
                        <dxi-column dataField="isExport" caption="Trạng thái" width="90" dataType="boolean">
                        </dxi-column>

                    </dx-data-grid>
                </dx-scroll-view>
            </div>
            <dxo-position at="top" my="right top" of="#target" offset="-25 0"></dxo-position>
        </dx-popup>
    </div>
</div>